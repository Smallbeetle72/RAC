<!DOCTYPE HTML>
    <head>
        <style>
            #clips   {position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;}
            #clip    {position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;}
        </style>
    </head>
    <body>
        <div id="clips">
            <video id="clip" autoplay="true" type="video/mp4" src="">
                <img src="" alt="" title="Your browser does not support the video tag">
            </video>
        </div>
        
        <script>
            let login = "bastiui";
            let period = "1";
            let index = 0;

            // TODO : récupérer tous les résultats d'un coup et les traiter tous ici plutôt que faire un ping pong front <-> back
            function getClip(index) {
                try {
                    fetch("http://localhost/RAC/clips.php", {
                        method: "POST",
                        headers: {
                        "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
                        },
                        body: `login=${login}&period=${period}&index=${index}`,
                    })
                    .then((response) => response.text())
                    .then((res) => document.getElementById('clip').setAttribute('src', res));

                } catch (error) {
                    console.log(error);
                }
            }

            // TODO : checker taille du tableau pour reboucler en index[0] si on a atteint la dernière vidéo du tableau
            function runClip() {
                document.getElementById('clip').addEventListener('ended', myHandler, false);
                function myHandler(e) {
                    if(!e) { e = window.event; }
                    getClip(index);
                    index++;
                }
            }

            getClip(index);
            runClip();

            

        </script>

    </body>
</HTML>